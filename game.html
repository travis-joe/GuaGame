<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>game 1</title>
  <style media="screen">
    canvas {
      border: 1px solid black
    }
  </style>
  <script src="utils.js"></script>
  <script src="guagame.js"></script>
  <script src="ball.js"></script>
  <script src="paddle.js"></script>
  <script src="block.js"></script>
  <script src="level.js"></script>
</head>

<body>
<canvas id="id-canvas" width="400" height="300"></canvas>

<script>

  var loadLevel = function (n) {
    var blocks = [];
    n = n - 1
    var level = levels[n];
    for (var i = 0; i < level.length; i++) {
      var p = level[i]
      var b = Block(p)
      blocks.push(b)
    }
    return blocks
  }
  var __main = function () {
    var paused = false

    var game = Game(fps)

    var paddle = Paddle();
    var ball = Ball();
    var blocks = [];
    blocks = loadLevel(1)

    game.registerAction('a', function () {
      paddle.moveLeft()
    })
    game.registerAction('d', function () {
      paddle.moveRight()
    })
    game.registerAction('f', function () {
      ball.fire()
    })
    window.addEventListener('keydown', function (e) {
      if (e.key === 'p') {
        paused = !paused
      }else if(e.key === '1'){
        blocks = loadLevel(1)
      }else if(e.key === '2'){
        blocks = loadLevel(2)
      }
    })

    game.update = function () {
      if (paused) {
        return
      }
      ball.move()
      //判断paddle相撞
      if (paddle.collide(ball)) {
        ball.revert()
      }

      //判断blocks相撞
      blocks.forEach(block => {
        if (block.collide(ball)) {
          // log('collide')
          ball.revert()
          block.kill()
        }
      })

    }

    game.draw = function () {
      game.drawImage(paddle)
      game.drawImage(ball)
      blocks.forEach(block => {
        if (block.alive) {
          game.drawImage(block)
        }
      })
    }
  }

  __main()
</script>
</body>

</html>